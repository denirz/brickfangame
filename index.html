<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">

  <script src="js/utils.js"></script>
  <script>
    // Paramaters
    let nlines = 30;
  </script>
  <script src="js/Quadrant.js"></script>
  <script>
    let a  = new Quadrant(1,1);
    let listitems = new Qlist();
    let listmashineitems = new Qlist();
    listmashineitems.color = "rgba(0,255 ,0, 1)";
    let b = new Quadrant(nlines-8,nlines-8);

    function mashinegame(canvas){
        console.log("LENTH",listmashineitems.items.length)
        if (listmashineitems.items.length ===0){
          var allowed_u = listitems.addQuadrant(b,fix=0);
          var allowed_m = listmashineitems.addQuadrant(b);
          listmashineitems.drawQlist(canvas);
          b.reload(canvas);
            return 0;
        }
        for(i=0;i<nlines;i++){
            for(j=0;j<nlines;j++){
                b.setcoords(canvas,j,i); //todo может быть добавить немнго ума в  такой перебор
                // console.log("Quad1:",b,"correctness:",b.checkcorrectness(listmashineitems));
                if((b.checkcorrectness(listmashineitems) > 0)&& ((b.checkcorrectness(listitems) ==0)
                || (b.checkcorrectness(listitems) > 0)) )
                {
                    console.log("Found",b);
                    listmashineitems.addQuadrant(b);
                    b.reload(canvas)
                    return 1;
                }
            }
        }

        console.log("NO moves!");
        b.reload(canvas)
    }

    function draw() {
        let canvas = document.getElementById("main");
        drawgrid(canvas);
        window.addEventListener("keyup", function (event) {
            if(event.key === ' '){
                a.rotate(canvas);
                a.output();
            }
            if ( event.key ==="ArrowRight"){
                // console.log(a);
                a.moveright(canvas)
            }
            if ( event.key =="ArrowLeft"){
                // console.log(a);
                a.moveleft(canvas)
            }
            if ( event.key =="ArrowUp"){
                // console.log(a);
                a.moveup(canvas)
            }
            if ( event.key =="ArrowDown"){
                // console.log(a);
                a.movedown(canvas)
            }
            if ( event.key =="f"){
                console.log(a);
                let r = a.fix(canvas,listitems);
                if(r ===1) { mashinegame(canvas);}
                // console.log(listitems)
            }
            if ( event.key =="m"){
                // console.log(a);
                // listitems.drawQlist(canvas)
                mashinegame(canvas)
            }
        }, false);
    }
  </script>




</head>

<body onload="draw()">

  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <h1>Hello world! This is brickfan game!</h1>
  <canvas  id="main" width="800" height="800" > </canvas>



  <!-- Add your site or application content here -->

  <script src="js/vendor/modernizr-{{MODERNIZR_VERSION}}.min.js"></script>
  <script src="https://code.jquery.com/jquery-{{JQUERY_VERSION}}.min.js" integrity="{{JQUERY_SRI_HASH}}" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-{{JQUERY_VERSION}}.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <!--<script>-->
    <!--window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;-->
    <!--ga('create', 'UA-XXXXX-Y', 'auto'); ga('send', 'pageview')-->
  <!--</script>-->
  <!--<script src="https://www.google-analytics.com/analytics.js" async defer></script>-->
</body>

</html>
