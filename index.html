<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">


  <script>
    let nlines = 60;
    // var gamefield  = new Array(nlines);
    // var x = new Array(10);

        // for (var i = 0; i < gamefield.length;  i++) {
        //   gamefield[i] = new Array(nlines);
        //   for (var j = 0; j<gamefield[i].length;j++){
        //       gamefield[i,j]=0;
        //   }
        //   }

    class Qlist{
            constructor(){
                this.items = new Array();
            }
          addQuadrant(Item){
                var b=Object.assign({},Item);
                var nerrors = 0;
                var nsiebling = 0
                this.items.forEach(function (e) {
                    var res =Item.checkother(e.x,e.y,e.n,e.m);
                    if(res == '-1'){nerrors++}
                    if(res == '1'){nsiebling++}
                });
                console.log(" Number of errors ",nerrors);
                console.log(" Number of siebling ",nsiebling);
                if (nerrors===0 && nsiebling >= 1)
                  {
                  this.items.push(b)
                      return 1
                  }
                if (this.items.length === 0)
                    {
                  this.items.push(b)
                        return 1
                  }
                return 0
          }
          drawQlist(canvas){
              var ctx = canvas.getContext("2d");
              var s = getCellsize();
              this.items.forEach(function (e) {
                  ctx.save()
                  ctx.fillStyle="rgba(0,0 ,255, 1)";
                  ctx.fillRect(e.x*s[0],e.y*s[1],e.n*s[0],e.m*s[1]);
                  ctx.strokeStyle="rgba(0,0 ,127, 1)";
                  ctx.strokeRect(e.x*s[0],e.y*s[1],e.n*s[0],e.m*s[1])
                  ctx.restore()
              })

          }
    }
    var listitems = new Qlist()

    class Quadrant{
        // var x , y;
        // var n,m;
        constructor(x,y){
            this.x=x;
            this.y=y;
            this.n=this.randsize()[0];
            this.m=this.randsize()[1];
        }
        randsize(){
            var n= parseInt(Math.random()*6)+1;
            var m= parseInt(Math.random()*6)+1;
            console.log("Random",n,m);
            return [n,m]
        }
        output(){
            console.log(this.x,this.n)
            console.log(this.y,this.m)
        }
        fix(canvas){
            var res = listitems.addQuadrant(this);
            console.log(res)
            if (res ===1){
              this.reload(canvas)
                }
        }
        reload(canvas){
            this.clear(canvas)
            this.n=this.randsize()[0];
            this.m=this.randsize()[1];
            this.draw(canvas);
            drawgrid(canvas)
        }
        rotate(canvas){
            this.clear(canvas);
            let temp=this.n;
            this.n=this.m;
            this.m=temp;
            this.draw(canvas);
            drawgrid(canvas);
        }
        checkother(x,y,n,m){
            console.log("CHECKOTHER")
            // просто проверка на пересечения:
            for(var x_t=this.x;x_t<this.x+this.n;x_t++){
                for(var y_t=this.y;y_t<this.y+this.m;y_t++){
                    if( x_t>x-1 && x_t<x+n && y_t>y-1 && y_t<y+m){
                        console.log("ERROR X",x_t,x,x+n);
                        console.log("ERROR Y",y_t,y,y+m);
                        return '-1';
                    }
                }
            }
            var sieb =0
            if (this.x===x+n && (this.y>=y && this.y< y+m)){sieb++}
            if (this.x===x+n && (this.y+this.m >y && this.y+this.m < y+m)){sieb++}
            if (this.x===x+n && (this.y+this.m < y && this.y+this.m > y+m)){sieb++}

            if (this.x+this.n===x && (this.y>=y && this.y< y+m)) {sieb++}
            if (this.x+this.n===x && (this.y+this.m >y && this.y+this.m < y+m)) {sieb++}
            if (this.x+this.n===x && (this.y+this.m <y && this.y+this.m > y+m)) {sieb++}

            if (this.y === y+m && (this.x>=x && this.x < x+n)){sieb++}
            if (this.y === y+m && (this.x<x && this.x+this.n > x)){sieb++}
            if (this.y+this.m === y && (this.x>=x && this.x <x+n)){sieb++}
            if (this.y+this.m === y && (this.x<x && this.x+this.n <x+n)){sieb++}
            console.log("Sieb",sieb);
            if (sieb >=1)
            {
                console.log("GOOD PLACE");
                return 1;
            }
        }
        clear(canvas){
            var ctx = canvas.getContext("2d");
            var s = getCellsize();
            ctx.clearRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1])
        }
        draw(canvas){
                  var ctx = canvas.getContext("2d");
                  ctx.fillStyle="rgba(255,0 , 0, 0.5)";
                  // ctx.fillStyle="FFFF00";
                  var s = getCellsize();
                  console.log("sizes",s)
                  ctx.fillRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
        }
        moveright(canvas){
            var ctx = canvas.getContext("2d");
            var s = getCellsize();
            ctx.clearRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
            ctx.fillStyle="rgba(255,0 , 0, 0.5)";
            this.x=this.x+1;
            drawgrid(canvas);
            ctx.fillRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
        }
        moveleft(canvas){
            var ctx = canvas.getContext("2d");
            var s = getCellsize();
            ctx.clearRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
            ctx.fillStyle="rgba(255,0 , 0, 0.5)";
            this.x=this.x-1;
            drawgrid(canvas);
            ctx.fillRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
        }
        moveup(canvas){
            var ctx = canvas.getContext("2d");
            var s = getCellsize();
            ctx.clearRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
            ctx.fillStyle="rgba(255,0 , 0, 0.5)";
            this.y=this.y-1;
            drawgrid(canvas);
            ctx.fillRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
        }
        movedown(canvas){
            var ctx = canvas.getContext("2d");
            var s = getCellsize();
            ctx.clearRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
            ctx.fillStyle="rgba(255,0 , 0, 0.5)";
            this.y=this.y+1;
            drawgrid(canvas);
            ctx.fillRect(this.x*s[0],this.y*s[1],this.n*s[0],this.m*s[1]);
        }


    }
    var a  = new Quadrant(1,1);

    function draw() {
         if (a){
            console.log("a=",a)
             }
             else {
             a = new Quadrant(1, 1);
         }
        var canvas = document.getElementById("main");
        drawgrid(canvas)
        // canvas.addEventListener("mousedown", click1, false);
        // canvas.addEventListener("mousedown", function(){Element(canvas)}, false);
        window.addEventListener("keyup", function (event) {
            console.log(event)
            // if(event.key == 'r'){
            //     a.reload(canvas)
            //     a.output();
            // }
            if(event.key == ' '){
                a.rotate(canvas)
                a.output();
            }
            if ( event.key =="ArrowRight"){
                console.log(a);
                a.moveright(canvas)
            }
            if ( event.key =="ArrowLeft"){
                console.log(a);
                a.moveleft(canvas)
            }
            if ( event.key =="ArrowUp"){
                console.log(a);
                a.moveup(canvas)
            }
            if ( event.key =="ArrowDown"){
                console.log(a);
                a.movedown(canvas)
            }
            if ( event.key =="f"){
                console.log(a);
                a.fix(canvas);
                console.log(listitems)
            }
            if ( event.key =="d"){
                // console.log(a);
                listitems.drawQlist(canvas)
            }
        }, false);


        // console.log('m here 1');
    }


    function drawgrid(canvas){
       var ctx = canvas.getContext("2d");
        var step = canvas.width/nlines;
        ctx.lineWidth = 1;
        ctx.beginPath();
        for ( var  i=0;i<nlines;i++ ){
            ctx.moveTo(step*i,0);
          ctx.lineTo(step*i,canvas.height);
        }

        var step = canvas.height/nlines;
        for ( var  i=0;i<nlines;i++ ){
            ctx.moveTo(0, step*i,0);
          ctx.lineTo(canvas.width,step*i);
        }
        ctx.stroke();
        listitems.drawQlist(canvas)
    }

    function getCellsize(){
        var canvas = document.getElementById("main"); // todo  научиться передавать в  аргументе тоже
      // var el = event.srcElement;
      var q_w = parseFloat(canvas.width/nlines);
      var q_h = parseFloat(canvas.height/nlines);
      return [q_w,q_h]
    }

    // function ableToLocate(x,y,n,m) {
    //         console.log(x,y,n,m);
    //         for (var i=x;i<x+n;i++){
    //           for (var j=y;j<y+m;j++){
    //               console.log("status",i,j,gamefield[i,j]);
    //               if (gamefield[i,j] != 0)
    //               {
    //                   return false;
    //               }
    //           }
    //         }
    //     return true
    // }

    // function fixInArray(x,y,n,m) {
    //         for (var i=x;i<x+n;i++){
    //           for (var j=y;j<y+m;j++){
    //               console.log("status",i,j,gamefield[i,j]);
    //               gamefield[i,j] = 1
    //           }
    //         }
    //
    // }
    // function Element(canvas) {
    //     var x= parseInt(Math.random()*6)+1;
    //     var y= parseInt(Math.random()*6)+1;
    //     console.log("Random",x,y);
    //
    //     var s = getCellsize();
    //     console.log(s[0]);
    //     console.log(s[1]);
    //     square=[x*s[0],y*s[1]];
    //     let ctx = canvas.getContext("2d");
    //     ctx.fillStyle="FF0000";
    //     ctx.fillRect(0,0,square[0],square[1]);
    //     // draw();
    //
    //     if (ableToLocate(0,0,x,y)){
    //         fixInArray(0,0,x,y);
    //         console.log("fixed");
    //         ctx.fillStyle="000000";
    //         ctx.fillRect(0,0,square[0],square[1]);
    //     }
    //     else {
    //         console.log("Impossible to fix ")
    //         return false
    //     }
    //
    //     // var s = getCellsize();
    //     // console.log(s[0]);
    //     // console.log(s[1]);
    //     // square=[x*s[0],y*s[1]];
    //     // let ctx = canvas.getContext("2d");
    //     // ctx.fillStyle="FF0000";
    //     // ctx.fillRect(0,0,square[0],square[1]);
    //     // ctx.fillStyle="FFFFFF";
    //
    //     // console.log(gamefield[x,y])
    //
    // }

  // function click1() {
  //     console.log(event);
  //     // console.log(event.layerX);
  //     // console.log(event.layerY);
  //     // var nlines=18; // todo научиться передавать в аргументе
  //     // console.log(nlines);
  //     // console.log(el);
  //     // console.log(event.layerX);
  //     var canvas = document.getElementById("main"); // todo  научиться передавать в  аргументе тоже
  //     // var el = event.srcElement;
  //     var q_w = parseFloat(canvas.width/nlines);
  //     var q_h = parseFloat(canvas.height/nlines);
  //     var q_x = parseInt(event.layerX/q_w,10);
  //     var q_y = parseInt(event.layerY/q_h,10);
  //     console.log("I'm here");
  //     console.log(q_x,q_y);
  //
  //     var ctx = canvas.getContext("2d");
  //     ctx.fillRect(q_x*q_w,q_y*q_h,q_w,q_h);
  //
  // }

  </script>




</head>

<body onload="draw()">

  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <p>Hello world! This is HTML5 Boilerplate.</p>
  <canvas  id="main" width="800" height="600" > </canvas>



  <!-- Add your site or application content here -->

  <script src="js/vendor/modernizr-{{MODERNIZR_VERSION}}.min.js"></script>
  <script src="https://code.jquery.com/jquery-{{JQUERY_VERSION}}.min.js" integrity="{{JQUERY_SRI_HASH}}" crossorigin="anonymous"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-{{JQUERY_VERSION}}.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <!-- Google Analytics: change UA-XXXXX-Y to be your site's ID. -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-XXXXX-Y', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>
</body>

</html>
